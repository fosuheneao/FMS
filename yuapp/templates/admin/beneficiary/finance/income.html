{% extends "base_auth_dash.html" %}
{% load static %}
{% load humanize %}
{% load currency_filters %}

{% block content %}
<div class="row">
  <div class="col-lg-12">
      <div class="card shadow-sm border-0">
          <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
              <h4 class="mb-0">
                  <i class="fa fa-money"></i> Revenue Breakdown 
                  <i class="fa fa-question-circle" data-toggle="tooltip" data-placement="top" title="Revenue from ONLY confirmed Harvest Records."></i>
              </h4>
              <a href="{% url 'harvest_index' %}" class="btn btn-sm btn-light border shadow-sm text-primary">
                  <i class="fa fa-arrow-left"></i> Back
              </a>
          </div>

          <div class="card-body">
              <div class="alert alert-info">
                  <h5>Total Revenue Earned: <span class="fw-bold text-success">{{ total_revenue|currency }}</span></h5>
                  <h6>Total Quantity Harvested: <span class="fw-bold">{{ total_quantity|floatformat:0 }} Units</span></h6>
              </div>

              <div class="table-responsive mt-3">
                {% if grouped_income %}
                  {% for crop_name, grades in grouped_income.items %}
                    <h5 class="text-primary">{{ crop_name }}</h5>
                    <table class="table table-hover table-bordered">
                        <thead class="table-primary text-dark fw-bold">
                            <tr>
                                <th>Grade</th>
                                <th>Quantity</th>
                                <th>Unit</th>
                                <th>Total Earnings</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for grade_name, data in grades.items %}
                            <tr>
                                <td>{{ grade_name }}</td>
                                <td>{{ data.total_quantity|currency }}</td>
                                <td>{{ data.unit }}</td>
                                <td>{{ data.total_revenue|currency }}</td>
                            </tr>
                            {% endfor %}
                            
                        </tbody>
                    </table>
                  {% endfor %}
                 
                {% else %}
                  <span class="text-center text-muted">No harvest records available.</span>
                {% endif %}
              </div>
          </div>
      </div>
  </div>
</div>

{% endblock %}